{"ast":null,"code":"import _objectSpread from \"@babel/runtime-corejs2/helpers/esm/objectSpread\";\nimport _classCallCheck from \"@babel/runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"@babel/runtime-corejs2/helpers/esm/createClass\";\nimport _possibleConstructorReturn from \"@babel/runtime-corejs2/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"@babel/runtime-corejs2/helpers/esm/getPrototypeOf\";\nimport _inherits from \"@babel/runtime-corejs2/helpers/esm/inherits\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport React from \"react\";\nimport { Component } from 'react';\nimport { Router } from '../routes';\nimport nextCookie from 'next-cookies';\nimport cookie from 'js-cookie';\nimport jwt from 'jsonwebtoken';\nexport var login =\n/*#__PURE__*/\nfunction () {\n  var _ref2 = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee(_ref) {\n    var token;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            token = _ref.token;\n            cookie.set('token', token);\n            Router.pushRoute('/dashboard');\n\n          case 3:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function login(_x) {\n    return _ref2.apply(this, arguments);\n  };\n}();\nexport var logout = function logout() {\n  cookie.remove('token'); // to support logging out from all windows\n\n  Router.push('/');\n}; // Gets the display name of a JSX component for dev tools\n\nvar getDisplayName = function getDisplayName(Component) {\n  return Component.displayName || Component.name || 'Component';\n};\n\nexport var withAuthSync = function withAuthSync(WrappedComponent, roleId) {\n  var _class, _temp;\n\n  return _temp = _class =\n  /*#__PURE__*/\n  function (_Component) {\n    _inherits(_class, _Component);\n\n    function _class() {\n      _classCallCheck(this, _class);\n\n      return _possibleConstructorReturn(this, _getPrototypeOf(_class).apply(this, arguments));\n    }\n\n    _createClass(_class, [{\n      key: \"render\",\n      value: function render() {\n        return React.createElement(WrappedComponent, this.props);\n      }\n    }], [{\n      key: \"getInitialProps\",\n      value: function () {\n        var _getInitialProps = _asyncToGenerator(\n        /*#__PURE__*/\n        _regeneratorRuntime.mark(function _callee2(ctx) {\n          var token, componentProps;\n          return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n            while (1) {\n              switch (_context2.prev = _context2.next) {\n                case 0:\n                  token = auth(ctx, roleId);\n                  ctx.token = token;\n                  _context2.t0 = WrappedComponent.getInitialProps;\n\n                  if (!_context2.t0) {\n                    _context2.next = 7;\n                    break;\n                  }\n\n                  _context2.next = 6;\n                  return WrappedComponent.getInitialProps(ctx);\n\n                case 6:\n                  _context2.t0 = _context2.sent;\n\n                case 7:\n                  componentProps = _context2.t0;\n                  return _context2.abrupt(\"return\", _objectSpread({}, componentProps, {\n                    token: token\n                  }));\n\n                case 9:\n                case \"end\":\n                  return _context2.stop();\n              }\n            }\n          }, _callee2);\n        }));\n\n        function getInitialProps(_x2) {\n          return _getInitialProps.apply(this, arguments);\n        }\n\n        return getInitialProps;\n      }()\n    }]);\n\n    return _class;\n  }(Component), _defineProperty(_class, \"Layout\", WrappedComponent.Layout), _defineProperty(_class, \"displayName\", \"withAuthSync(\".concat(getDisplayName(WrappedComponent), \")\")), _temp;\n};\nexport var auth = function auth(ctx, roleId) {\n  var token = ctx.token;\n  var user = token && jwt.verify(token, 'SECRET');\n\n  if (roleId !== undefined && user.roleId !== roleId) {\n    if (ctx.req) {\n      ctx.res.writeHead(302, {\n        Location: '/login'\n      });\n      ctx.res.end();\n      return;\n    }\n\n    Router.push('/login');\n  }\n\n  if (ctx.req && !token) {\n    ctx.res.writeHead(302, {\n      Location: '/login'\n    });\n    ctx.res.end();\n    return;\n  } // We already checked for server. This should only happen on client.\n\n\n  if (!token) {\n    Router.push('/login');\n  }\n\n  return token;\n};","map":null,"metadata":{},"sourceType":"module"}