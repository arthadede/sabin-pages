{"ast":null,"code":"import _JSON$stringify from \"@babel/runtime-corejs2/core-js/json/stringify\";\nimport _Object$keys from \"@babel/runtime-corejs2/core-js/object/keys\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nimport _objectSpread from \"@babel/runtime-corejs2/helpers/esm/objectSpread\";\nimport _toConsumableArray from \"@babel/runtime-corejs2/helpers/esm/toConsumableArray\";\nimport _slicedToArray from \"@babel/runtime-corejs2/helpers/esm/slicedToArray\";\nimport { Typography, Button, Drawer, Row, Col, message } from 'antd';\nimport React, { useState, useEffect } from 'react';\nimport Highlight from 'react-highlight';\nimport _ from 'lodash';\n\nfunction PatternExtractor(props) {\n  var _useState = useState(null),\n      _useState2 = _slicedToArray(_useState, 2),\n      windowSize = _useState2[0],\n      setWindowSize = _useState2[1];\n\n  var _useState3 = useState(false),\n      _useState4 = _slicedToArray(_useState3, 2),\n      drawer = _useState4[0],\n      setDrawer = _useState4[1];\n\n  var _useState5 = useState(null),\n      _useState6 = _slicedToArray(_useState5, 2),\n      selected = _useState6[0],\n      setSelected = _useState6[1];\n\n  var _useState7 = useState({}),\n      _useState8 = _slicedToArray(_useState7, 2),\n      selectedNested = _useState8[0],\n      setSelectedNested = _useState8[1];\n\n  var handleResize = function handleResize() {\n    setWindowSize({\n      width: window.innerWidth,\n      height: window.innerHeight\n    });\n  };\n\n  useEffect(function () {\n    window.addEventListener(\"resize\", handleResize);\n    window.addEventListener(\"mouseup\", handleOnKeyDown);\n    return function () {\n      window.removeEventListener(\"resize\", handleResize);\n      window.removeEventListener(\"mouseup\", handleOnKeyDown);\n    };\n  }, []);\n\n  var createScriptItem = function createScriptItem(pos, data, zIndex, classname) {\n    var element = document.createElement('span');\n\n    var label = _(props.dataLabel).find(function (item) {\n      return item.name === data.label;\n    });\n\n    var scrollTop = document.documentElement.scrollTop || document.body.scrollTop;\n    var scrollLeft = document.documentElement.scrollLeft || document.body.scrollLeft;\n    element.className = \"\".concat(classname, \" annotation-script-item annotation-script-item-mark\");\n    element.style.position = 'absolute';\n    element.style.top = \"\".concat(pos.top + scrollTop, \"px\");\n    element.style.left = \"\".concat(pos.left + scrollLeft, \"px\");\n    element.style.width = \"\".concat(pos.width, \"px\");\n    element.style.height = \"\".concat(pos.height, \"px\");\n    element.style.background = data.hasOwnProperty('label') ? label.color + '70' : '#e6f7ff';\n    element.style.zIndex = zIndex;\n    document.body.appendChild(element);\n  };\n\n  var createLabelItem = function createLabelItem(pos, data, zIndex, classname) {\n    var element = document.createElement('span');\n\n    var label = _(props.dataLabel).find(function (item) {\n      return item.name === data.label;\n    });\n\n    var scrollTop = document.documentElement.scrollTop || document.body.scrollTop;\n    var scrollLeft = document.documentElement.scrollLeft || document.body.scrollLeft;\n    element.className = \"\".concat(classname, \" annotation-script-item annotation-script-item-label\");\n    element.style.position = 'absolute';\n    element.style.color = '#fff';\n    element.style.background = label.color;\n    element.style.padding = '0px 6px';\n    element.style.top = \"\".concat(pos.top + scrollTop - 15, \"px\");\n    element.style.left = \"\".concat(pos.left + scrollLeft, \"px\");\n    element.innerText = data.label;\n    element.style.zIndex = zIndex;\n    element.style.cursor = 'pointer';\n    element.addEventListener('click', function (e) {\n      return handleRemoveLabel(data);\n    });\n    document.body.appendChild(element);\n  };\n\n  var createScriptItemNested = function createScriptItemNested(pos, data, zIndex, classname) {\n    var wrapper = document.querySelector('.annotation-modal-drawer .ant-drawer-wrapper-body');\n    var element = document.createElement('span');\n\n    var label = _(props.dataLabel).find(function (item) {\n      return item.name === data.label;\n    });\n\n    var scrollTop = wrapper.scrollTop;\n    var scrollLeft = wrapper.scrollLeft;\n    element.className = \"\".concat(classname, \" annotation-script-item annotation-script-item-mark\");\n    element.style.position = 'absolute';\n    element.style.top = \"\".concat(pos.top + scrollTop, \"px\");\n    element.style.left = \"\".concat(pos.left + scrollLeft, \"px\");\n    element.style.width = \"\".concat(pos.width, \"px\");\n    element.style.height = \"\".concat(pos.height, \"px\");\n    element.style.background = data.hasOwnProperty('label') ? label.color + '70' : '#e6f7ff';\n    element.style.zIndex = zIndex;\n    wrapper.appendChild(element);\n  };\n\n  var createLabelItemNested = function createLabelItemNested(pos, data, zIndex, classname) {\n    var wrapper = document.querySelector('.annotation-modal-drawer .ant-drawer-wrapper-body');\n    var element = document.createElement('span');\n\n    var label = _(props.dataLabel).find(function (item) {\n      return item.name === data.label;\n    });\n\n    var scrollTop = wrapper.scrollTop;\n    var scrollLeft = wrapper.scrollLeft;\n    element.className = \"\".concat(classname, \" annotation-script-item annotation-script-item-label\");\n    element.style.position = 'absolute';\n    element.style.color = '#fff';\n    element.style.background = label.color;\n    element.style.padding = '0px 6px';\n    element.style.top = \"\".concat(pos.top + scrollTop - 15, \"px\");\n    element.style.left = \"\".concat(pos.left + scrollLeft, \"px\");\n    element.innerText = data.label;\n    element.style.zIndex = zIndex;\n    element.style.cursor = 'pointer';\n    element.addEventListener('click', function (e) {\n      return handleRemoveLabel(data);\n    });\n    wrapper.appendChild(element);\n  };\n\n  var handleRemoveLabel = function handleRemoveLabel(data) {\n    if (selected) {\n      setSelectedNested(function (state) {\n        var result = {};\n\n        for (var key in state) {\n          if (state[key].startOffset !== data.startOffset) {\n            if (state[key].endOffset !== data.endOffset) {\n              result[key] = state[key];\n            }\n          }\n        }\n\n        return result;\n      });\n    } else {\n      var result = _.filter(props.value, function (item) {\n        if (data.startOffset >= item.startOffset && data.endOffset <= item.endOffset) {\n          return false;\n        }\n\n        return true;\n      });\n\n      props.onChange(result);\n    }\n  };\n\n  var handleOnKeyDown = function handleOnKeyDown(e) {\n    var current = e.target.childNodes[0];\n    var el = document.getElementById(\"annotation-script\").childNodes[0];\n\n    if (current === el) {\n      handleAddSource();\n    }\n  };\n\n  var recursiveDefineLabel = function recursiveDefineLabel(data, node, zIndex) {\n    _.forEach(data, function (item) {\n      var pos, range;\n      range = document.createRange();\n      range.setStart(node, item.startOffset);\n      range.setEnd(node, item.endOffset);\n      pos = range.getClientRects();\n\n      if (item.label) {\n        createLabelItem(pos[0], item, zIndex[1]);\n\n        _.forEach(pos, function (n) {\n          return createScriptItem(n, item, zIndex[0], 'annotation-contianer');\n        });\n      } else _.forEach(pos, function (n) {\n        return createScriptItem(n, item, zIndex[0], 'annotation-contianer');\n      });\n\n      item.script && recursiveDefineLabel(item.script, node, zIndex);\n    });\n  };\n\n  useEffect(function () {\n    var node = document.getElementById(\"annotation-script\").childNodes[0];\n    selected ? recursiveDefineLabel([].concat(_toConsumableArray(props.value), [selected]), node, [5, 100]) : recursiveDefineLabel(props.value, node, [5, 100]);\n    return function () {\n      var elementScriptItem = document.querySelectorAll('body>.annotation-script-item');\n      console.log(document.body);\n      elementScriptItem.forEach(function (n) {\n        return document.body.removeChild(n);\n      });\n    };\n  }, [props.value, selected, windowSize]);\n  useEffect(function () {\n    var node = document.getElementById(\"annotation-script-drawer\");\n\n    if (node) {\n      var pos, range;\n      var elementScript = node.childNodes[0];\n\n      var _loop = function _loop(item) {\n        if (selectedNested.hasOwnProperty(item) && elementScript) {\n          range = document.createRange();\n          range.setStart(elementScript, selectedNested[item].startOffset);\n          range.setEnd(elementScript, selectedNested[item].endOffset);\n          pos = range.getClientRects();\n          createLabelItemNested(pos[0], selectedNested[item], 1500, 'annotation-drawer');\n\n          _.forEach(pos, function (n) {\n            return createScriptItemNested(n, selectedNested[item], 1000, 'annotation-drawer');\n          });\n        }\n      };\n\n      for (var item in selectedNested) {\n        _loop(item);\n      }\n\n      return function () {\n        var wrapper = document.querySelector('.annotation-modal-drawer .ant-drawer-wrapper-body');\n        var elementScriptItem = document.querySelectorAll('.annotation-drawer.annotation-script-item');\n        elementScriptItem.forEach(function (n) {\n          return wrapper.removeChild(n);\n        });\n      };\n    }\n  }, [selectedNested, windowSize]);\n\n  var handleAddSource = function handleAddSource() {\n    if (window.getSelection().anchorNode !== null) {\n      if (window.getSelection().anchorNode.wholeText === props.dataSource) {\n        var pos = window.getSelection().getRangeAt(0);\n\n        if (pos.startOffset !== pos.endOffset) {\n          setDrawer(true);\n          setSelected({\n            startOffset: pos.startOffset,\n            endOffset: pos.endOffset - pos.startOffset + pos.startOffset // color: '#bae7ff',\n            // text: props.dataSource.substr(pos.startOffset, pos.endOffset - pos.startOffset),\n\n          });\n        }\n\n        window.getSelection().removeAllRanges();\n      } else {\n        message.warning(\"Element invalid.\");\n      }\n    } else {\n      message.warning(\"Please mark your text.\");\n    }\n  };\n\n  var handleAddScript = function handleAddScript(label) {\n    var current = document.getElementById(\"annotation-script-drawer\").childNodes[0].wholeText;\n\n    if (window.getSelection().anchorNode !== null) {\n      if (window.getSelection().anchorNode.wholeText === current) {\n        var pos = window.getSelection().getRangeAt(0);\n        setSelectedNested(function (state) {\n          return _objectSpread({}, state, _defineProperty({}, label.name, {\n            startOffset: pos.startOffset,\n            endOffset: pos.endOffset,\n            label: label.name // color: label.color,\n            // text: current.substr(pos.startOffset, pos.endOffset),\n\n          }));\n        });\n        window.getSelection().removeAllRanges();\n      } else {\n        message.warning(\"Element invalid.\");\n      }\n    } else {\n      message.warning(\"Please mark your text.\");\n    }\n  };\n\n  var handleSubmitDrawer = function handleSubmitDrawer() {\n    if (_Object$keys(selectedNested).length === 0) {\n      message.warning(\"Label is not defined.\");\n      return;\n    } // Konversi dari obj key ke object array\n\n\n    var convert = _.values(selectedNested);\n\n    var script = _.map(convert, function (item) {\n      return _objectSpread({}, item, {\n        startOffset: selected.startOffset + item.startOffset,\n        endOffset: selected.startOffset + item.endOffset\n      });\n    });\n\n    var transform = _objectSpread({}, selected, {\n      script: script\n    });\n\n    props.onChange(function (state) {\n      return [].concat(_toConsumableArray(state), [transform]);\n    });\n    setDrawer(false);\n    setSelected(null);\n    setSelectedNested({});\n  };\n\n  return React.createElement(\"div\", {\n    style: {\n      minHeight: 500\n    }\n  }, React.createElement(\"div\", null, React.createElement(Typography.Paragraph, {\n    id: \"annotation-script\"\n  }, props.dataSource)), React.createElement(Drawer, {\n    title: \"Pattern Extractor\",\n    className: \"annotation-modal-drawer\",\n    width: 700,\n    placement: \"left\",\n    visible: drawer,\n    closable: false,\n    maskClosable: false\n  }, React.createElement(Row, null, React.createElement(Col, {\n    md: 24\n  }, React.createElement(Typography.Title, {\n    strong: true,\n    level: 4,\n    style: {\n      marginBottom: 16\n    }\n  }, \"Select text and press the label for annotation\"), React.createElement(\"div\", {\n    style: {\n      minHeight: 300,\n      border: '1px dashed #d2d2d2',\n      padding: '20px 16px',\n      marginBottom: 16\n    }\n  }, React.createElement(\"div\", {\n    style: {\n      paddingBottom: 16\n    }\n  }, props.dataLabel.map(function (item, index) {\n    return React.createElement(Button, {\n      key: index,\n      className: \"ant-custom ant-tag\",\n      style: {\n        background: item.color,\n        color: '#fff'\n      },\n      onClick: function onClick() {\n        return handleAddScript(item);\n      }\n    }, item.name);\n  })), React.createElement(\"div\", {\n    id: \"annotation-script-drawer\"\n  }, selected && props.dataSource.substr(selected.startOffset, selected.endOffset - selected.startOffset)))), React.createElement(Col, {\n    md: 24\n  }, React.createElement(Typography.Title, {\n    level: 4\n  }, \"Result Annotation:\"), React.createElement(Highlight, {\n    style: {\n      height: 300\n    }\n  }, _JSON$stringify(selectedNested, null, 2))), React.createElement(Col, {\n    md: 24\n  }, React.createElement(Button, {\n    block: true,\n    type: \"primary\",\n    style: {\n      marginBottom: 16\n    },\n    onClick: handleSubmitDrawer,\n    disabled: _.keys(selectedNested).length === 0\n  }, \"Submit\"), React.createElement(Button, {\n    type: \"default\",\n    block: true,\n    style: {\n      marginBottom: 16\n    },\n    onClick: function onClick() {\n      setDrawer(false);\n      setTimeout(function () {\n        setSelected(null);\n        setSelectedNested({});\n      }, 500);\n    }\n  }, \"Cancel\")))));\n}\n\nexport default PatternExtractor;","map":null,"metadata":{},"sourceType":"module"}